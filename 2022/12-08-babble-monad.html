<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
    <title>
        
            ä¹±è°ˆ Monad |
         
        Heaven Is
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/fontawesome/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/css/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/css/solid.min.css">

    

<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Heaven Is" type="application/atom+xml">
</head>

<body>
    <div class="body-container">
        <div class="header-wrapper"><header>
    <div class="header-container">
        <div class="header-menu-list">
            <ul>
            
                <li>
                    <a href="/">[-&gt;+&lt;]</a>
                </li>
            
                <li>
                    <a href="/about.html">About</a>
                </li>
            
            </ul>
        </div>
    </div>
</header>
</div>
        <div class="main-wrapper"><main>
    <div class="main-container">
        <div class="post-details">
            
            <div class="post-title">
                <h1>ä¹±è°ˆ Monad</h1>
            </div>
            <div class="post-meta">
                <i class="fa-solid fa-clock"></i>&nbsp;<span class="post-date">2022/12/08</span>
            </div>
            
            <div class="post-content">
                <h2 id="preface"><a class="markdownIt-Anchor" href="#preface"></a> Preface</h2>
<p>è¿™å‡ å¤©æŒ‰ç€æˆ‘åŠåŠå­çš„ haskell æ°´å¹³ç¨å¾®ç ”ç©¶äº†ä¸€ä¸‹ monadï¼Œè¿˜æ˜¯æœ‰ç‚¹ä¸æ˜¯å¾ˆç†è§£ï¼Œåªèƒ½æµ…æµ…åœ°è°ˆä¸€è°ˆæˆ‘è‡ªå·±çš„æƒ³æ³•ï¼Œé”™è¯¯å’Œçº°æ¼éš¾ä»¥é¿å…ï¼Œæ‰€è°“ä¹±è°ˆæ˜¯ä¹Ÿã€‚</p>
<h2 id="the-moand"><a class="markdownIt-Anchor" href="#the-moand"></a> The Moand</h2>
<p>è¿™éƒ¨åˆ†å°½é‡ä¼šè¯¦ç»†åœ°é˜è¿°ä¸€ä¸‹<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/19635359/answer/172074046">åˆ˜æœˆåŠå¤§ç¥çš„è¿™ç¯‡æ–‡ç« </a>ï¼Œé€‚å½“çš„æ”¹åŠ¨äº†ä¸€äº›ä¾‹å­ï¼Œé¦–å…ˆä» <code>Maybe</code> çš„æ„é€ å‡½æ•°å¼€å§‹ï¼Œ</p>
<pre><code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword">data</span> <span class="hljs-type">Maybe</span> a = <span class="hljs-type">Just</span> a | <span class="hljs-type">Nothing</span></span></code></pre>
<p>å…¶ä¸­ <code>a</code> æ˜¯ä¸€ä¸ªç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥â€œå®ä¾‹åŒ–â€ä¸€ä¸ª <code>Maybe Int</code> ç±»å‹å‡ºæ¥ç­‰ç­‰ï¼Œå¹¶ä¸”å­˜åœ¨ä¸¤ä¸ªâ€œæ„é€ å™¨â€ï¼Œ<code>Just</code> å’Œ <code>Nothing</code>ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ª <code>safeDiv</code> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä½œç”¨æ˜¯ä¿è¯åœ¨é‡åˆ°é™¤é›¶é”™è¯¯æ—¶ä¸ä¼šè®©ç¨‹åº crashï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª <code>Maybe Int</code> ç±»å‹ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-title">safeDiv</span> :: <span class="hljs-type">Int</span> -&gt; <span class="hljs-type">Int</span> -&gt; <span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span>
<span class="hljs-title">safeDiv</span> _ <span class="hljs-number">0</span> = <span class="hljs-type">Nothing</span>
<span class="hljs-title">safeDiv</span> x y = <span class="hljs-type">Just</span> (x `div` y)	<span class="hljs-comment">-- é™¤æ³•è¿ç®—ç¬¦ / ä¸èƒ½ä½œç”¨åœ¨ Int ä¸Š</span></code></pre>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„é™¤æ³•è¿ç®—ä¸­ï¼Œéƒ½èƒ½ä¿è¯é™¤é›¶å®‰å…¨çš„è¯ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå†™å‡ºä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-comment">-- å®‰å…¨åœ°è®¡ç®— a/b/c/d/e</span>
<span class="hljs-title">case</span> safeDiv a b <span class="hljs-keyword">of</span>
  <span class="hljs-type">Nothing</span> -&gt; <span class="hljs-type">Nothing</span>
  <span class="hljs-type">Just</span> x  -&gt; <span class="hljs-keyword">case</span> safeDiv x c <span class="hljs-keyword">of</span>	<span class="hljs-comment">-- å¦‚æœ b != 0ï¼Œèƒ½å¤Ÿç»§ç»­è¿›è¡Œé™¤æ³•ï¼Œå°è¯•è®¡ç®— (a/b)/c</span>
    <span class="hljs-type">Nothing</span> -&gt; <span class="hljs-type">Nothing</span>
    <span class="hljs-type">Just</span> y  -&gt; <span class="hljs-keyword">case</span> safeDiv y d <span class="hljs-keyword">of</span>	<span class="hljs-comment">-- å¦‚æœ c != 0ï¼Œç»§ç»­å°è¯•è®¡ç®— (a/b/c)/d</span>
      <span class="hljs-type">Nothing</span> -&gt; <span class="hljs-type">Nothing</span>
      <span class="hljs-type">Just</span> z  -&gt; safeDiv z e		<span class="hljs-comment">-- å¦‚æœ d != 0ï¼Œç»§ç»­å°è¯•è®¡ç®— (a/b/c/d)/e</span></code></pre>
<p>å¯ä»¥çœ‹åˆ°ä»£ç éå¸¸çš„å•°å—¦ï¼Œè€Œä¸”çœ‹ç€å¾ˆéš¾å—ï¼ˆå¯¹åº”è¿‡ç¨‹å¼è¯­è¨€å°±æ˜¯ä¸€å±‚åˆä¸€å±‚çš„ if åµŒå¥—ï¼‰ï¼Œæœ‰æ²¡æœ‰åŠæ³•èƒ½ä¼˜åŒ–å‘¢ï¼Ÿå®é™…ä¸Šä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»å‡ ä¸ª <code>case</code> ä¸­æå–å‡ºä¸€äº›å…¬å…±ç‰¹å¾ï¼ˆä¼ªä»£ç ï¼Œ<code>&#123;Int&#125;</code> è¡¨ç¤ºæ­¤å¤„çš„å˜é‡ç±»å‹ä¸º <code>Int</code>ï¼‰ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-comment">-- å°† safeDiv x c ä½¿ç”¨ \x -&gt; safeDiv x c æ›¿æ¢ï¼Œå³å¯å¾—åˆ°æœ€ç®€æ´çš„ Int -&gt; Maybe Int å‡½æ•°ï¼›</span>
<span class="hljs-comment">--   å› ä¸ºè¢« lambda æ•è·çš„é‡åŸºæœ¬éƒ½èƒ½è¢«è§†ä½œå¸¸é‡ï¼ˆï¼Ÿï¼‰</span>
<span class="hljs-title">case</span> &#123;<span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span>&#125; <span class="hljs-keyword">of</span>
  <span class="hljs-type">Nothing</span> -&gt; <span class="hljs-type">Nothing</span>
  <span class="hljs-type">Just</span> x -&gt; &#123;<span class="hljs-type">Int</span> -&gt; <span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span>&#125; x</code></pre>
<p>ç»™ä¸Šé¢çš„ç±»å‹é™„ä¸Šåå­—å’Œç±»å‹ï¼Œå°±æˆäº†ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-title">fmap&#x27;</span> :: (<span class="hljs-type">Int</span> -&gt; <span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span> -&gt; <span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span>
<span class="hljs-title">fmap&#x27;</span> f m = <span class="hljs-keyword">case</span> m <span class="hljs-keyword">of</span>
  <span class="hljs-type">Nothing</span> -&gt; <span class="hljs-type">Nothing</span>
  <span class="hljs-type">Just</span> x -&gt; f x</code></pre>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ª <code>Maybe</code> çš„æ‰€è°“ functorï¼ˆå‡½å­ï¼‰ï¼Œ</p>
<blockquote>
<p>Maybe ä¹‹æ‰€ä»¥æ˜¯å‡½å­ï¼Œæ˜¯å› ä¸ºå®ƒå¯ä»¥é€šè¿‡ fmapï¼ˆfunctor mapï¼‰æŠŠæ‰€æœ‰çš„å‡½æ•°æ‹åˆ°ã€ŒMaybe ç©ºé—´ã€é‡Œã€‚</p>
</blockquote>
<p>æœ‰äº†å‡½å­ä¹‹åï¼Œæˆ‘ä»¬å°è¯•æŠŠè¿™ä¸ªæŠ½è±¡åº”ç”¨åˆ°æˆ‘ä»¬çš„ä¾‹å­ä¸Šå»çœ‹çœ‹ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-title">let</span>
    x = safeDiv a b			<span class="hljs-comment">-- ç¬¬ä¸€å±‚ a/b</span>
    y = fmap&#x27; (\v -&gt; safeDiv v c) x	<span class="hljs-comment">-- ç¬¬äºŒå±‚ (a/b)/c</span>
    z = fmap&#x27; (\v -&gt; safeDiv v d) y	<span class="hljs-comment">-- ç¬¬ä¸‰å±‚ (a/b/c)/d</span>
<span class="hljs-title">in</span>
    fmap&#x27; (\v -&gt; safeDiv v e) z		<span class="hljs-comment">-- ç¬¬å››å±‚ (a/b/c/d)/e</span></code></pre>
<p>æŠ›å¼€æ€§èƒ½ä¸è°ˆï¼ˆé›¾ï¼‰ï¼Œè¿™ç§å†™æ³•çœ‹èµ·æ¥å·²ç»èˆ’æœå¾ˆå¤šäº†ï¼Œä½†æ˜¯æ„Ÿè§‰è¿˜æ˜¯â€œå­˜åœ¨è¿›æ­¥ç©ºé—´â€çš„æ ·å­ã€‚ä¹Ÿçš„ç¡®ï¼Œhaskell ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª <code>&gt;&gt;=</code> è¿ç®—ç¬¦ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ¥å®ç° <code>fmap</code>ï¼Œå¹¶ä¸”å†æ¬¡ä¼˜åŒ–ä¸Šé¢çš„ä»£ç ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-comment">-- è¿™æ˜¯ä¸€ä¸ªä¸­ç¼€è¿ç®—ç¬¦ï¼Œè¿™ä¸ªä¾‹å­ä¸­ (&gt;&gt;=) m f ç­‰ä»·äº m &gt;&gt;= fï¼›å®šä¹‰ä¸ fmap å®Œå…¨ä¸€è‡´</span>
(&gt;&gt;=) :: <span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span> -&gt; (<span class="hljs-type">Int</span> -&gt; <span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span>
(&gt;&gt;=) m f = <span class="hljs-keyword">case</span> m <span class="hljs-keyword">of</span>
  <span class="hljs-type">Nothing</span> -&gt; <span class="hljs-type">Nothing</span>
  <span class="hljs-type">Just</span> x -&gt; f x

<span class="hljs-comment">-- the optimzed version</span>
<span class="hljs-title">safeDiv</span> a b &gt;&gt;= (\v -&gt;
  safeDiv v c &gt;&gt;= (\w -&gt;
    safeDiv w d &gt;&gt;= (\x -&gt;
      safeDiv x e)))</code></pre>
<p>å¥½åƒï¼Œæœ‰ç‚¹åå‘ä¼˜åŒ–äº†ï¼Ÿæ²¡äº‹ï¼Œhaskell ä¸ºè¿™ä¸ªæ¨¡å¼è®¾è®¡äº† <code>do</code> è¯­æ³•ç³–ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-title">val</span> = <span class="hljs-keyword">do</span>
  x &lt;- safeDiv a b
  y &lt;- safeDiv x c
  z &lt;- safeDiv y d
  safeDiv z e</code></pre>
<p>ç®€æ´ï¼Œå¥½çœ‹ï¼Œelegantï¼å½“ç„¶ï¼Œå› ä¸ºæ ‡å‡†åº“é‡Œ<a target="_blank" rel="noopener" href="https://hackage.haskell.org/package/base-4.17.0.0/docs/Data-Maybe.html">å·²ç»æä¾›</a>äº† <code>instance Monad Maybe</code> äº†ï¼Œæ‰€ä»¥æœ€åçš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†å®šä¹‰ä»»ä½•å…¶ä»–å‡½æ•°äº†ï¼Œåªéœ€è¦ä¿ç•™ <code>safeDiv</code> å°±å¯ä»¥äº†ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿèƒ½è‡ªè¡Œå®ç°å„ç§å„æ ·çš„ functorï¼Œæœ‰ç‚¹åƒæ˜¯ OOP çš„æ¥å£ä¸€æ ·ï¼ˆç¬‘ï¼‰ã€‚</p>
<h2 id="functor-and-monad"><a class="markdownIt-Anchor" href="#functor-and-monad"></a> Functor and Monad</h2>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„ <code>fmap'</code> æ˜¯è‡ªå·±å®šä¹‰çš„ï¼Œè€Œå®˜æ–¹é’ˆå¯¹ <a target="_blank" rel="noopener" href="https://hackage.haskell.org/package/base-4.17.0.0/docs/src/GHC.Base.html"><code>Maybe</code> å®ç°çš„ <code>fmap</code></a> æ˜¯ä¸å¤ªä¸€æ ·çš„ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-comment">-- | @since 2.01</span>
<span class="hljs-class"><span class="hljs-keyword">instance</span>  <span class="hljs-type">Functor</span> <span class="hljs-type">Maybe</span>  <span class="hljs-keyword">where</span></span>
    fmap _ <span class="hljs-type">Nothing</span>       = <span class="hljs-type">Nothing</span>
    fmap f (<span class="hljs-type">Just</span> a)      = <span class="hljs-type">Just</span> (f a)	<span class="hljs-comment">-- notice here!</span></code></pre>
<p>æˆ‘ä»¬çš„ä¾‹å­ä¸­æ¨¡å¼åŒ¹é…é¡¹æ˜¯ <code>Just x -&gt; fx</code>ï¼Œä½†æ˜¯å®˜æ–¹çš„å´æ˜¯ <code>Just x -&gt; Just (f a)</code>ï¼Œåè€…å…¶å®æ‰æ˜¯æ ‡å‡†æ ¼å¼ï¼›<code>safeDiv</code> è¿™ä¸ªä¾‹å­ä¸åŒæ˜¯å› ä¸ºæˆ‘ä»¬å®Œå…¨æ˜¯æ ¹æ®å‡½æ•°ç±»å‹æ¥â€œç‰¹åŒ–â€çš„ä¸€ä¸ªï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-comment">-- safeDiv version of fmap</span>
<span class="hljs-title">fmap</span> :: (<span class="hljs-type">Int</span> -&gt; <span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span> -&gt; <span class="hljs-type">Maybe</span> <span class="hljs-type">Int</span>

<span class="hljs-comment">-- haskell fmap</span>
<span class="hljs-title">fmap</span> :: (a -&gt; b) -&gt; f a -&gt; f b</code></pre>
<p>Obviouslyï¼ŒåŒºåˆ«å°±å‡ºæ¥äº†ã€‚è¿™é‡Œæè¿™ä¸ªåŒºåˆ«æ˜¯å› ä¸ºè¿™é‡Œè¦å¼€å§‹åŒºåˆ† functor å’Œ monad äº†ã€‚å‰æ–‡çš„ä¾‹å­ä¸­å¯èƒ½å¤§å®¶ä¼šè§‰å¾— monad è·Ÿ functor æ˜¯ä¸€å›äº‹ï¼Œå®é™…ä¸Šæ˜¯å­˜åœ¨å·®å¼‚çš„ã€‚Haskell å®šä¹‰äº† <a target="_blank" rel="noopener" href="https://wiki.haskell.org/Functor-Applicative-Monad_Proposal">Functor-Applicative-Monad</a> ç»“æ„ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ applicative å¿…å®šæ˜¯ functorï¼Œmonad å¿…å®šæ˜¯ applicativeï¼Œä¸‰è€…æœ‰ç»§æ‰¿å…³ç³»ï¼Œæ‰€ä»¥ functor å…¶å®æ˜¯æ€§è´¨æ˜¯æ¯”è¾ƒå¼±çš„ã€‚</p>
<p>è¿™éƒ¨åˆ†ä¸»è¦ä¼šæ ¹æ®å“”ç«™<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1qh411q7cS">é¹¤ç¿”ä¸‡é‡Œçš„è§†é¢‘</a>è¿›è¡Œä¸€å®šçš„ç»†è‡´é˜è¿°ï¼Œä¹Ÿä¼šå¯¹å‰æ–‡åˆ˜æœˆåŠå¤§ç¥çš„æ–‡ç« è¿›è¡Œå†è¡¥å……ã€‚å…ˆä» functor å¼€å§‹å§ï¼Œå®ƒçš„ä½œç”¨çœ‹ä¸Šé¢å‡½æ•°å®šä¹‰å°±èƒ½ç•¥çŸ¥ä¸€äºŒäº†ï¼Œç»™å®šä¸€ä¸ªä¸€èˆ¬çš„å‡½æ•°ï¼Œè®©å®ƒå»å¤„ç†â€œè£…ç®±â€åçš„ç±»å‹ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªåŒæ ·è¢«è£…ç®±äº†çš„ç±»å‹ï¼Œçœ‹ haskell çš„ <code>Maybe</code> å®ç°å°±çŸ¥é“äº†ï¼Œè¿™é‡Œè´´å‡ºæ¥è§†é¢‘çš„å‡ ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-comment">-- instance Functor Maybe</span>
<span class="hljs-title">fmap</span> (+<span class="hljs-number">3</span>) (<span class="hljs-type">Just</span> <span class="hljs-number">1</span>) = <span class="hljs-type">Just</span> <span class="hljs-number">4</span>
<span class="hljs-title">fmap</span> (+<span class="hljs-number">3</span>) <span class="hljs-type">Nothing</span> = <span class="hljs-type">Nothing</span>

<span class="hljs-comment">-- instance Functor []</span>
<span class="hljs-title">fmap</span> (+<span class="hljs-number">3</span>) [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]</code></pre>
<p>å½“ç„¶ functor æ ¹æ®å®šä¹‰ï¼Œå®ƒçš„å±€é™æ€§å°±åœ¨äºåªèƒ½å¤„ç†å€¼ï¼Œå¯¹äºå‡½æ•°ï¼Œå®ƒåªä¼šè¿”å›ä¸€ä¸ªè£…ç®±åçš„å‡½æ•°ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-title">fmap</span> (+) (<span class="hljs-type">Just</span> <span class="hljs-number">3</span>) = <span class="hljs-type">Just</span> (+<span class="hljs-number">3</span>)</code></pre>
<p>å¹¶ä¸”æˆ‘ä»¬æ— æ³•ç»§ç»­å¾€ä¸‹è¿›è¡Œäº†ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-title">fmap</span> (<span class="hljs-type">Just</span> (+<span class="hljs-number">3</span>)) (<span class="hljs-type">Just</span> <span class="hljs-number">3</span>) = ğŸ¤¯</code></pre>
<p>è¿™æ—¶å°±éœ€è¦å¼•å…¥ applicative æ¥å¤„ç†äº†ï¼Œç›´æ¥çœ‹å®˜æ–¹å®šä¹‰ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-comment">-- | @since 2.01</span>
<span class="hljs-class"><span class="hljs-keyword">instance</span> <span class="hljs-type">Applicative</span> <span class="hljs-type">Maybe</span> <span class="hljs-keyword">where</span></span>
    pure = <span class="hljs-type">Just</span>

    <span class="hljs-type">Just</span> f  &lt;*&gt; m       = fmap f m
    <span class="hljs-type">Nothing</span> &lt;*&gt; _m      = <span class="hljs-type">Nothing</span>

    liftA2 f (<span class="hljs-type">Just</span> x) (<span class="hljs-type">Just</span> y) = <span class="hljs-type">Just</span> (f x y)
    liftA2 _ _ _ = <span class="hljs-type">Nothing</span>

    <span class="hljs-type">Just</span> _m1 *&gt; m2      = m2
    <span class="hljs-type">Nothing</span>  *&gt; _m2     = <span class="hljs-type">Nothing</span></code></pre>
<p>ä¸»è¦å…³æ³¨ <code>&lt;*&gt;</code> è¿™ä¸ªå‡½æ•°ï¼ˆè¯»ä½œ applyï¼‰ï¼Œå¯ä»¥çœ‹åˆ° applicative å°† <code>Just (+3)</code> é‡Œé¢çš„ <code>(+3)</code> å‡½æ•°ç»™å–å‡ºæ¥äº†ï¼Œç„¶åé€šè¿‡ <code>fmap</code> åº”ç”¨å‡½æ•°ï¼Œè¿™æ ·å¾—åˆ°çš„ç»“æœä¾ç„¶æ˜¯ä¸ª <code>Maybe</code> ç±»å‹ï¼Œit just worksã€‚</p>
<p>åŒæ ·ï¼Œè´´ä¸Šè§†é¢‘ä¸­çš„å‡ ä¸ªä¾‹å­å½“ä½œ memoï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-comment">-- instance Applicative Maybe</span>
<span class="hljs-type">Just</span> (+<span class="hljs-number">3</span>) &lt;*&gt; <span class="hljs-type">Just</span> <span class="hljs-number">1</span> = <span class="hljs-type">Just</span> <span class="hljs-number">4</span>

<span class="hljs-comment">-- instance Applicative []</span>
[(+<span class="hljs-number">1</span>), (*<span class="hljs-number">2</span>)] &lt;*&gt; [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>] = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>]</code></pre>
<p>å¦‚æœæˆ‘ä»¬æŠŠå‰æ–‡ä¾‹å­ä¸­ <code>safeDiv</code> é‡Œçš„ <code>fmap'</code> åˆ å»ï¼Œé‚£ä¹ˆä¸‹é¢è¿™ä¸ªå‡½æ•°å°±ä¼šå¼€å§‹å‡ºç±»å‹é”™è¯¯ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-comment">-- without customized fmap function</span>
<span class="hljs-title">let</span>
    x = safeDiv a b			<span class="hljs-comment">-- ç¬¬ä¸€å±‚ a/b</span>
    y = fmap (\v -&gt; safeDiv v c) x	<span class="hljs-comment">-- ç¬¬äºŒå±‚ (a/b)/c</span>
    z = fmap (\v -&gt; safeDiv v d) y	<span class="hljs-comment">-- ç¬¬ä¸‰å±‚ (a/b/c)/d</span>
<span class="hljs-title">in</span>
    fmap (\v -&gt; safeDiv v e) z		<span class="hljs-comment">-- ç¬¬å››å±‚ (a/b/c/d)/e</span></code></pre>
<p>åŸå› å‰æ–‡è¯´äº†ï¼Œ<code>fmap</code> å…¶å®è¿”å›çš„æ˜¯ <code>Just (f a)</code>ï¼Œä¹Ÿå°±æ˜¯ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-title">fmap</span> (\v -&gt; safeDiv v <span class="hljs-number">1</span>) (<span class="hljs-type">Just</span> <span class="hljs-number">10</span>) = <span class="hljs-type">Just</span> (<span class="hljs-type">Just</span> <span class="hljs-number">10</span>)</code></pre>
<p>è¿™å°±æœ‰ç‚¹éš¾å—äº†ï¼Œä¸æ˜¯æˆ‘ä»¬é¢„æœŸæƒ³è¦çš„ <code>Just 10</code>ã€‚è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦ä½¿ç”¨ monad äº†ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢å®šä¹‰ä¸­ <code>&gt;&gt;=</code>ï¼ˆè¯»ä½œ bindï¼‰æ¥è¿›è¡Œå¤„ç†äº†ï¼Œä¹Ÿæ˜¯ç›´æ¥çœ‹å®˜æ–¹ä»£ç å§ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-comment">-- | @since 2.01</span>
<span class="hljs-class"><span class="hljs-keyword">instance</span>  <span class="hljs-type">Monad</span> <span class="hljs-type">Maybe</span>  <span class="hljs-keyword">where</span></span>
    (<span class="hljs-type">Just</span> x) &gt;&gt;= k      = k x
    <span class="hljs-type">Nothing</span>  &gt;&gt;= _      = <span class="hljs-type">Nothing</span>

    (&gt;&gt;) = (*&gt;)</code></pre>
<p>å¯¹æ¯”å®˜æ–¹ <code>fmap</code> å°±èƒ½çœ‹åˆ°ï¼Œmonad çš„ instance ä¸­ä¸å†æ˜¯ <code>Just (k x)</code>ï¼Œè€Œæ˜¯ç®€ä»‹ã€æ˜äº†çš„ <code>k x</code>ï¼Œneatã€‚è¿™ä¹Ÿæ˜¯è·Ÿæˆ‘ä»¬åœ¨ <code>safeDiv</code> ä¸­å®ç°çš„ <code>&gt;&gt;=</code> ç‰ˆæœ¬å®Œå…¨ç­‰ä»·ï¼Œæ‰€ä»¥å®ƒå°±æ˜¯ä¸€ä¸ª monadã€‚</p>
<p>ä¾ç„¶ï¼Œè´´ä¸Šä¸€äº›è§†é¢‘ä¸­çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-type">Just</span> <span class="hljs-number">1</span> &gt;&gt;= \x -&gt; <span class="hljs-type">Just</span> (x+<span class="hljs-number">3</span>) = <span class="hljs-type">Just</span> <span class="hljs-number">4</span></code></pre>
<p>ä¸ªäººç†è§£ï¼Œæ— è®ºæ˜¯ functorã€applicative è¿˜æ˜¯ monadï¼Œå®ƒä»¬æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸ºäº†æ›´å¥½åœ°å¤„ç†â€œè¢«è£…ç®±çš„ç±»å‹â€ã€‚è€Œ haskell æ¯”è¾ƒæ¨å´‡è¿™ç§ç›’å­æ¨¡å¼ï¼Œå¾ˆå¤šç±»å‹åƒ <code>Maybe a</code>ã€<code>IO a</code> è¿™ç§ï¼Œéƒ½å®ç°äº† monad çš„ bind è¿ç®—ç¬¦ã€‚</p>
<p>æ¯”å¦‚ Haskell é‡Œå¸¸ç”¨çš„æ•°ç»„å±•å¼€ï¼Œå…¶å®ä¹Ÿæ˜¯å€ŸåŠ© functor æ¥å®Œæˆçš„ï¼Œæ¥è‡ª<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/39734882">è¯„è®ºåŒºçš„ Narc å¤§ç¥</a>ï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-comment">-- original</span>
[ x + y | x &lt;- [<span class="hljs-number">1</span>..<span class="hljs-number">3</span>], y &lt;- [<span class="hljs-number">1</span>..x]]

<span class="hljs-comment">-- desuger</span>
[<span class="hljs-number">1</span>..<span class="hljs-number">3</span>] &gt;&gt;= \x -&gt; [<span class="hljs-number">1</span>..x] &gt;&gt;= \y -&gt; return (x + y)</code></pre>
<p>å¦å¤– JavaScript çš„ <code>Promise</code> ä¹Ÿæ˜¯è·Ÿ monad æœ‰ç‚¹â€œå¼‚æ›²åŒå·¥â€ä¹‹å¦™çš„ï¼Œæ¯•ç«Ÿ lazy eval èƒ½çœ‹ä½œæ˜¯å¼‚æ­¥ï¼ˆã€‚</p>
<h2 id="myth"><a class="markdownIt-Anchor" href="#myth"></a> Myth</h2>
<p>æˆ‘ä¸ªäººä¾ç„¶æœ‰ä¸€äº›è¿·æ€ï¼Œå¯èƒ½éœ€è¦ç³»ç»Ÿåœ°å­¦ä¹ ä¸‹èŒƒç•´è®ºæ‰èƒ½è§£æƒ‘äº†ã€‚</p>
<ol>
<li>éƒ½è¯´ monad èƒ½éš”ç¦»å‰¯ä½œç”¨ï¼Œä½†æ˜¯æˆ‘çœ‹ä¸‹ï¼Œæ„Ÿè§‰è·Ÿé—­åŒ…å·®ä¸å¤šï¼Ÿå°†æ‰€æœ‰çŠ¶æ€è£…ç®±åˆ°ä¸€ä¸ªé—­åŒ…ä¸­ï¼Œå½“ç„¶å¤–éƒ¨æ— æ³•ä¿®æ”¹ï¼Œ<a target="_blank" rel="noopener" href="https://stackoverflow.com/a/79077">Stack Overflow ä¸Šä¹Ÿæœ‰è®¨è®º</a>ï¼Œè¯´åŒºåˆ«åœ¨äºâ€œA monad is (roughly) more like a context in which functions can be chained together sequentially, and controls how data is passed from one function to the next.â€</li>
<li>å¯¹ç”¨æ³•ä¾ç„¶ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œæš‚æ—¶çš„æƒ³æ³•æ˜¯ï¼Œmonad å°±æ˜¯ç”¨æ¥å¤„ç†â€œç›’å­â€çš„ï¼Œside effect å¯ä»¥è£…è¿›ç›’å­ä¸­ï¼Œerror handling ä¹Ÿå¯ä»¥è£…è¿›å»ï¼Œç­‰ç­‰ï¼›å¹¶ä¸” monad å¯ä»¥â€œä¼ é€’â€ï¼ˆä¸åŒäº closure åªèƒ½æ•è·å‡½æ•°å†…çš„ï¼Œmonad å¯ä»¥æ•è·æ•´ä¸ªé“¾å¼è°ƒç”¨ä¸Šçš„ç»“æœ)ï¼ŒåŠ ä¸Š <code>return</code> å‡½æ•°çš„è¾…åŠ©ï¼Œå®¹æ˜“å®ç° chain callï¼Œå¹¶ä¸” chain ä¸Šçš„å‡½æ•°éƒ½å…±äº«æ•´ä¸ª contextï¼Ÿ</li>
<li>ä¸€ä¸ªè‡ªå‡½å­èŒƒç•´ä¸Šçš„å¹ºåŠç¾¤ã€‚ã€‚å—¯ï¼Œè¿˜æ˜¯ä¸å¤ªæ‡‚ğŸ˜‚</li>
</ol>
<p>è¿˜æœ‰ï¼ŒåŸçŸ¥ä¹å¸–å­é‡Œè®²è¿°äº†ä¸€ä¸ª <code>join</code> æ“ä½œï¼š</p>
<pre><code class="hljs haskell"><span class="hljs-title">let</span> x = safeDiv a b
    y = fmap (safeDiv c) x
    z = (fmap . fmap) (safeDiv d) y
    <span class="hljs-keyword">in</span> (fmap . fmap . fmap) (safeDiv e) z

<span class="hljs-title">join</span> :: <span class="hljs-type">Maybe</span> (<span class="hljs-type">Maybe</span> a) -&gt; <span class="hljs-type">Maybe</span> a
  join (<span class="hljs-type">Just</span> x) = x
  join <span class="hljs-type">Nothing</span>  = <span class="hljs-type">Nothing</span>

(&gt;&gt;=) :: <span class="hljs-type">Maybe</span> a -&gt; (a -&gt; <span class="hljs-type">Maybe</span> b) -&gt; <span class="hljs-type">Maybe</span> b
  (&gt;&gt;=) mbx f = join (fmap f mbx)</code></pre>
<p>è¿™ä¸€éƒ¨åˆ†æˆ‘æš‚æ—¶è¿˜ä¸æ˜¯å¾ˆæ‡‚ï¼Œç­”ä¸»ç»™çš„ä¾‹å­ä¸­é‚£ä¸€ä¸² <code>fmap</code> æˆ‘æš‚æ—¶è¿˜æ˜¯æ²¡èƒ½æ¨å¯¼å‡ºç±»å‹å‡ºæ¥ï¼ˆä¸å¤ªç†Ÿæ‚‰ <code>.</code> æ“ä½œç¬¦ï¼Œæ˜¯ haskell è¶…é«˜æ ¡çº§çš„æ–°æ‰‹äº†ï¼‰ã€‚To be continuedã€‚</p>
<p>å…¶å®è‡ªå·±è¿˜æ˜¯æœ‰æŒºå¤šåœ°æ–¹ä¸æ‡‚çš„ï¼Œä¸è¿‡ haskell å¯èƒ½æš‚æ—¶ä¸ä¼šå†å­¦ä¹ äº†ï¼Œç›®å‰å¯¹ erlang æ›´æœ‰å…´è¶£ä¸€äº›ï¼Œå­¦ä¸€é—¨è¯­è¨€ç­‰äºå­¦å®Œäº†å¹¶å‘èŒƒå¼ï¼Œä¸é¦™å—ä¸é¦™å—ï¼ˆå…¶å®ä¸»è¦æ˜¯æ•°å­¦å¤ªæ¸£äº†ï¼Œçœ‹äº†ä¸€å°ä¼šèŒƒç•´è®ºå°±å·²ç»å¼€å§‹æ­‡èœäº†ğŸ¤§ï¼‰ã€‚</p>

            </div>
        </div>
    </div>
</main>

  

</div>
        <div class="footer-wrapper"><footer>
    <div class="footer-container">
        <div class="footer-meta">
            
                <div class="footer-meta-copyright">
                    &copy; 2023 Heaven Is.
                </div>
            
            
            
                <div class="footer-meta-rss">
                    <a href="/atom.xml"><i class="fa-solid fa-rss"></i></a>
                </div>
            
        </div>
    </div>
</footer>
</div>
    </div>
</body>
</html>
